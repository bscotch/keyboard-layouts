# Keyboard Layouts & Virtual Keycodes

When we handle keyboard inputs in GameMaker, on Windows, what we get is a "virtual key" constant value. This value is generated by the operating system based on the user's keyboard layout.

For handling inputs this doesn't really matter, because we don't actually care what key the user is pressing, just that it's doing what the user expects.

The problem is that when we _display_ the keybindings they'll show the wrong thing for non-US keyboards. This will be very confusing to the user, since neither the default nor their set keybindings will look like the buttons they press.

To that end, we need to be able to map all of the virtual keycodes to characters based on the user's keyboard. For each supported language we'd want reasonable defaults, but also need to allow the user to specify a different layout (since a user can use a different keyboard layout than the default for their language).

## Usage

- Clone/Pull this repo
- Install [pnpm](https://pnpm.io/installation)
- In this project directory, run `pnpm install`
- (optional) To scrape the latest remote resources, run `pnpm download`
- To get a JSON file of Virtual Keycodes that deviate from the US Keybouard layout (when uppercased), run `node scripts/process-windows-layouts.mjs` with a comma-separated list of keyboard IDs (the Windows DLL names)

For example:

`node scripts/process-windows-layouts.mjs kbdus,kbdfrna,kbdsp,kbdbr,kbdit,kbdgr,kbd106,kbdtuq,kbdpl,kbdla`

Returns:

```json
{
  "kbd106": {
    "186": ":",
    "187": ";",
    "192": "@",
    "222": "^"
  },
  "kbdbr": {
    "186": "Ç",
    "191": ";",
    "192": "'",
    "220": "]",
    "221": "["
  },
  "kbdfrna": {
    "48": "»",
    "49": "À",
    "50": "É",
    "51": "È",
    "52": "Ê",
    "53": "(",
    "54": ")",
    "55": "‘",
    "56": "’",
    "57": "«",
    "187": "+",
    "191": ":",
    "192": "@",
    "219": "/",
    "220": "*",
    "226": "<"
  },
  "kbdgr": {
    "186": "Ü",
    "187": "+",
    "191": "#",
    "192": "Ö",
    "219": "SS",
    "222": "Ä",
    "226": "<"
  },
  "kbdit": {
    "186": "È",
    "187": "+",
    "191": "Ù",
    "192": "Ò",
    "219": "'",
    "221": "Ì",
    "222": "À",
    "226": "<"
  },
  "kbdla": {
    "187": "+",
    "191": "}",
    "192": "Ñ",
    "219": "'",
    "220": "|",
    "221": "¿",
    "222": "{",
    "226": "<"
  },
  "kbdpl": {
    "186": "Ł",
    "187": "+",
    "191": "'",
    "219": "Ż",
    "220": "Ó",
    "221": "Ś",
    "222": "Ą",
    "226": "<"
  },
  "kbdsp": {
    "187": "+",
    "191": "Ç",
    "192": "Ñ",
    "219": "'",
    "220": "º",
    "221": "¡",
    "226": "<"
  },
  "kbdtuq": {
    "186": "Ş",
    "191": "Ö",
    "192": "\"",
    "219": "Ğ",
    "220": "Ç",
    "221": "Ü",
    "222": "İ",
    "223": "*",
    "226": "<"
  }
}
```

## Resources

- Keyboard Layout data: https://kbdlayout.info
- Table mapping languages to default keyboard layouts on Windows: https://learn.microsoft.com/en-us/windows-hardware/manufacture/desktop/default-input-locales-for-windows-language-packs
- Microsoft's list of layouts: https://learn.microsoft.com/en-us/globalization/windows-keyboard-layouts
